<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HPC Cluster GPU Survey</title>
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--text:#1f2937;--muted:#6b7280;--primary:#4f46e5;--ring:#c7d2fe;--red:#ef4444}
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    body{margin:0;background:linear-gradient(180deg,#f8fafc, #eef2ff)}
    .wrap{max-width:900px;margin:0 auto;padding:28px}
    h1{margin:0 0 8px;font-size:clamp(22px,3vw,30px)}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .section{background:var(--card);padding:18px;border-radius:16px;box-shadow:0 6px 24px rgba(31,41,55,.05);border:1px solid #e5e7eb;margin:14px 0}
    label{font-size:14px;color:#111827;margin-bottom:6px;display:block}
    input,select,textarea{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:12px;outline:none}
    input:focus,select:focus,textarea:focus{box-shadow:0 0 0 3px var(--ring);border-color:#a5b4fc}
    textarea{resize:vertical}
    .grid{display:grid;gap:12px}
    @media(min-width:780px){.grid-2{grid-template-columns:1fr 1fr}.row{grid-template-columns:7fr 3fr 2fr}}
    .row{display:grid;gap:12px;align-items:end}
    .btn{appearance:none;border:1px solid transparent;border-radius:14px;padding:10px 16px;background:var(--primary);color:#fff;font-weight:600;cursor:pointer}
    .btn.secondary{background:#fff;border-color:#e5e7eb;color:#111}
    .btn.link{background:#eef2ff;color:#3730a3;border-color:#c7d2fe}
    .btn.danger{background:#fee2e2;color:#991b1b;border-color:#fecaca}
    .toolbar{display:flex;align-items:center;justify-content:space-between}
    .muted{color:var(--muted)}
    .error{background:#fee2e2;border:1px solid #fecaca;color:#991b1b;padding:10px 12px;border-radius:12px}
    .success{background:#ecfeff;border:1px solid #a5f3fc;color:#155e75;padding:10px 12px;border-radius:12px}
    .small{font-size:12px;color:#6b7280}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>HPC Cluster GPU Survey</h1>
      <p class="lead">Select one or more GPU models and enter the quantity for each — all on the same line.</p>
    </header>

    <form id="survey-form" class="grid" onsubmit="return false;">
      <section class="section">
        <h2>About you</h2>
        <div class="grid grid-2">
          <div>
            <label for="name">Name</label>
            <input id="name" required />
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" type="email" required />
          </div>
          <div class="grid-2" style="grid-column:1/-1">
            <div>
              <label for="org">Institution / Organization</label>
              <input id="org" />
            </div>
            <div>
              <label for="usecase">Primary use case (e.g., GenAI, CFD, MD, training, inference)</label>
              <input id="usecase" />
            </div>
          </div>
        </div>
      </section>

      <section class="section">
        <h2>GPU selections</h2>
        <div id="rows" class="grid" aria-live="polite"></div>
        <div class="toolbar">
          <button type="button" class="btn link" id="add-row">+ Add another GPU</button>
          <div class="muted">Total GPUs selected: <strong id="total">0</strong></div>
        </div>
      </section>

      <section class="section">
        <h2>Notes (optional)</h2>
        <textarea id="notes" rows="4" placeholder="Interconnects, node configs, timelines, vendor preferences, etc."></textarea>
      </section>

      <div id="msg"></div>

      <div style="display:flex;gap:10px">
        <button class="btn" id="submit-btn" type="submit">Submit</button>
        <button class="btn secondary" id="reset-btn" type="button">Reset</button>
      </div>
      <p class="small">By submitting, you consent to storage and processing of your responses for analysis purposes.</p>
    </form>
  </div>

  <script>
  // ======= BACKEND CONFIG =======
  // Choose where to save responses:
  //   - 'power_automate'  → Excel via a Power Automate HTTP-trigger flow (requires premium HTTP trigger)
  //   - 'nocodeapi'       → Google Sheets via NoCodeAPI (free tier available)
  const BACKEND_TYPE = 'nocodeapi'; // change to 'nocodeapi' if using Google Sheets

  // Set this to your endpoint URL depending on BACKEND_TYPE:
  // Power Automate: paste your Flow's POST URL (When an HTTP request is received)
  // NoCodeAPI (Google Sheets): e.g. https://v1.nocodeapi.com/<you>/googlesheets/<token>?tabId=Responses
  const FLOW_URL = 'https://v1.nocodeapi.com/jacobeurglunes/google_sheets/nYgFqREeMbkYalpK';
  // ===============================

  // === If using NoCodeAPI (Google Sheets), your sheet tab should have this header row:
  // Timestamp | Name | Email | Organization | Use Case | Selections (JSON) | Total GPUs | Notes

  const GPU_GROUPS = [
    { label: "NVIDIA Data Center", items: [
      "H200 SXM (141GB)",
      "H100 SXM (80GB)",
      "H100 PCIe (80GB)",
      "A100 SXM (80GB)",
      "A100 PCIe (40GB)",
      "L40S (48GB)",
      "RTX 6000 Ada (48GB)",
      "A40 (48GB)",
      "A30 (24GB)",
      "A10 (24GB)"
    ]},
    { label: "AMD Data Center", items: [
      "MI300X (192GB)",
      "MI300A (128GB)",
      "MI250 (128GB)"
    ]},
    { label: "Other / Edge", items: [
      "Grace Hopper GH200",
      "Consumer RTX 4090 (24GB)",
      "Other (specify in Notes)"
    ]}
  ];

  const rowsEl = document.getElementById('rows');
  const totalEl = document.getElementById('total');
  const form = document.getElementById('survey-form');
  const msgEl = document.getElementById('msg');

  function makeSelect(id){
    const sel = document.createElement('select');
    sel.id = id;
    sel.required = true;
    GPU_GROUPS.forEach(g=>{
      const og = document.createElement('optgroup');
      og.label = g.label;
      g.items.forEach(item=>{
        const opt = document.createElement('option');
        opt.value = item; opt.textContent = item; og.appendChild(opt);
      });
      sel.appendChild(og);
    });
    const placeholder = document.createElement('option');
    placeholder.value = ""; placeholder.textContent = "Select a GPU…"; placeholder.selected = true; placeholder.disabled = true;
    sel.insertBefore(placeholder, sel.firstChild);
    return sel;
  }

  function makeQtyInput(id){
    const inp = document.createElement('input');
    inp.type = 'number'; inp.min = '0'; inp.step = '1'; inp.placeholder = '0'; inp.id = id;
    inp.addEventListener('input', updateTotal);
    return inp;
  }

  function rowTemplate(index){
    const row = document.createElement('div');
    row.className = 'row'; row.dataset.index = index;

    const gWrap = document.createElement('div');
    const gLabel = document.createElement('label'); gLabel.textContent = 'GPU model'; gLabel.setAttribute('for', `gpu-${index}`);
    const gSel = makeSelect(`gpu-${index}`);
    gWrap.appendChild(gLabel); gWrap.appendChild(gSel);

    const qWrap = document.createElement('div');
    const qLabel = document.createElement('label'); qLabel.textContent = 'Quantity'; qLabel.setAttribute('for', `qty-${index}`);
    const qInp = makeQtyInput(`qty-${index}`);
    qWrap.appendChild(qLabel); qWrap.appendChild(qInp);

    const bWrap = document.createElement('div');
    const btn = document.createElement('button');
    btn.type = 'button'; btn.className = 'btn danger'; btn.textContent = 'Remove';
    btn.addEventListener('click', ()=>{ row.remove(); updateTotal(); });
    bWrap.appendChild(btn);

    row.appendChild(gWrap); row.appendChild(qWrap); row.appendChild(bWrap);
    return row;
  }

  function addRow(){
    const idx = rowsEl.children.length;
    rowsEl.appendChild(rowTemplate(idx));
  }

  function updateTotal(){
    let sum = 0;
    [...rowsEl.querySelectorAll("input[id^='qty-']")].forEach(inp=>{
      const v = parseInt(inp.value||'0',10); if(Number.isFinite(v)) sum += v;
    });
    totalEl.textContent = String(sum);
  }

  function getSelections(){
    const selections = [];
    [...rowsEl.children].forEach(row=>{
      const sel = row.querySelector('select');
      const qty = row.querySelector('input');
      const model = sel.value; const q = parseInt(qty.value||'0',10);
      if(model && q>0) selections.push({ model, qty: q });
    });
    return selections;
  }

  function setMessage(kind, text){
    msgEl.className = kind === 'error' ? 'error' : 'success';
    msgEl.textContent = text;
  }

  // === Submission backends ===
  async function submitToPowerAutomate(payload){
    // Use text/plain to avoid CORS preflight in some setups
    const res = await fetch(FLOW_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify(payload)
    });
    return res.ok;
  }

  async function submitToNoCodeAPI(payload){
    const row = [[
      new Date().toISOString(),
      payload.respondent.name,
      payload.respondent.email,
      payload.respondent.org,
      payload.respondent.useCase,
      JSON.stringify(payload.selections),
      payload.totals.totalGPUs,
      payload.respondent.notes
    ]];
    const res = await fetch(FLOW_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ values: row })
    });
    return res.ok;
  }

  async function submitPayload(payload){
    if(!FLOW_URL || FLOW_URL.includes('YOUR-FLOW-OR-NOCODEAPI-ENDPOINT-HERE')){
      setMessage('error','Configure FLOW_URL at the top of the file first.');
      return false;
    }
    if(BACKEND_TYPE === 'power_automate'){
      return submitToPowerAutomate(payload);
    } else if (BACKEND_TYPE === 'nocodeapi'){
      return submitToNoCodeAPI(payload);
    } else {
      setMessage('error','Unknown BACKEND_TYPE.');
      return false;
    }
  }

  // Init
  document.getElementById('add-row').addEventListener('click', addRow);
  document.getElementById('reset-btn').addEventListener('click', ()=>{
    form.reset(); rowsEl.innerHTML=''; addRow(); updateTotal(); msgEl.textContent=''; msgEl.className='';
  });
  addRow();

  // Submit handler
  const submitBtn = document.getElementById('submit-btn');
  document.getElementById('submit-btn').addEventListener('click', async()=>{
    if (submitBtn.disabled) return;
    msgEl.textContent=''; msgEl.className='';

    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    if(!name){ setMessage('error','Please enter your name.'); return; }
    if(!email){ setMessage('error','Please enter a contact email.'); return; }
    const selections = getSelections();
    if(selections.length===0){ setMessage('error','Select at least one GPU with quantity > 0.'); return; }

    const payload = {
      submittedAt: new Date().toISOString(),
      respondent: {
        name,
        email,
        org: document.getElementById('org').value.trim(),
        useCase: document.getElementById('usecase').value.trim(),
        notes: document.getElementById('notes').value.trim()
      },
      selections,
      totals: { totalGPUs: selections.reduce((s,r)=>s+r.qty,0) }
    };

    submitBtn.disabled = true; const original = submitBtn.textContent; submitBtn.textContent = 'Submitting…';
    try{
      const ok = await submitPayload(payload);
      if(ok){
        setMessage('success','Thanks! Your response was recorded.');
      }else{
        setMessage('error','Submission failed.');
      }
    }catch(err){
      setMessage('error',`Submission failed: ${err.message}`);
    }finally{
      submitBtn.disabled = false; submitBtn.textContent = original;
    }
  });
</script>
</body>
</html>

